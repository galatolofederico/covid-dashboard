!function(e){var t={};function r(n){if(t[n])return t[n].exports;var a=t[n]={i:n,l:!1,exports:{}};return e[n].call(a.exports,a,a.exports,r),a.l=!0,a.exports}r.m=e,r.c=t,r.d=function(e,t,n){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var a in e)r.d(n,a,function(t){return e[t]}.bind(null,a));return n},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r(r.s=0)}([function(e,t){function r(e){return function(e){if(Array.isArray(e)){for(var t=0,r=new Array(e.length);t<e.length;t++)r[t]=e[t];return r}}(e)||function(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}function n(e){currentlayer.resetStyle(),e.setStyle({weight:3,color:"#666",dashArray:"",fillOpacity:.7}),L.Browser.ie||L.Browser.opera||L.Browser.edge||e.bringToFront(),infoBox.update(e.feature.properties)}function a(){currentlayer.resetStyle(),infoBox.update()}function o(e,t){t.on({mouseover:function(e){feature_persist||n(e.target)},mouseout:function(e){feature_persist||a()},click:function(e){u(),feature_persist=!0,n(e.target)}})}function i(e,t,r){animation<0&&($("#playButton").removeClass("fa-play"),$("#playButton").addClass("fa-pause"),current_time=0,r.addLayer(e[current_time]),currentlayer=e[current_time],$("#slider").val(0),$("#currentDate").text(t[0]),animation=setInterval((function(){e[current_time].resetStyle(),r.removeLayer(e[current_time]),current_time=(current_time+1)%e.length,r.addLayer(e[current_time]),currentlayer=e[current_time],$("#slider").val(current_time/(e.length-1)*100),$("#currentDate").text(t[current_time])}),500))}function u(){animation>0&&($("#playButton").removeClass("fa-pause"),$("#playButton").addClass("fa-play"),clearInterval(animation),animation=-1)}function c(e){var t=e.toString(16);return 1==t.length?"0"+t:t}function s(e){return"#"+c(e[0])+c(e[1])+c(e[2])}function l(e,t){scale=20;var r=1-(t=Math.log((scale-1)*t+1)/Math.log(scale)),n=t;return s([Math.round(e[0][0]*r+e[1][0]*n),Math.round(e[0][1]*r+e[1][1]*n),Math.round(e[0][2]*r+e[1][2]*n)])}function p(e,t,r,n){return function(a){return void 0!==e[a.properties.prov_acr]?value=e[a.properties.prov_acr][n]:void 0!==e[a.properties.reg_istat_code]?value=e[a.properties.reg_istat_code][n]:value=0,{fillColor:l(t,value/r),weight:2,opacity:1,color:"white",dashArray:"1",fillOpacity:.7}}}function d(e){var t=void 0;for(key in e)(void 0===t||Math.max.apply(Math,r(e[key]))>t)&&(t=Math.max.apply(Math,r(e[key])));return t}function m(e){return new Promise((function(t,r){$.getJSON("./assets/"+e,(function(e){e?t(e):r()}))}))}function f(){u(),void 0!==currentlayer&&map.removeLayer(currentlayer),m(current_sequence.map).then((function(e){layers=function(e,t,r){layers=[];for(var n=0;n<r.length;n++)max=d(time_sequence),style=p(time_sequence,t.gradient,max,n),layers.push(L.geoJson(e,{style:style,onEachFeature:o}));return layers}(e,current_sequence,time_ref),i(layers,time_ref,map)}))}function _(){$("#dropdownCurrent").text(sequence),current_sequence=sequences[sequence],time_ref=current_sequence.time_ref,m(current_sequence.sequence).then((function(e){time_sequence=e,"Mappa"==page&&(map&&(map.off(),map.remove()),map=function(){mapmargin=$("#navbar").outerHeight(!0)+$("#sliderContainer").outerHeight(!0)+.1*$(window).height(),$("#map").css("height",$(window).height()-mapmargin);var e=L.map("map",{center:[41.9028,12.4964],zoomSnap:.1});return e.fitBounds([[47.438004,3.678534],[36.544542,18.931975]]),L.tileLayer("http://{s}.tile.osm.org/{z}/{x}/{y}.png",{attribution:'&copy; <a href="http://osm.org/copyright">OpenStreetMap</a> contributors'}).addTo(e),e}(),feature_persist=!1,function(e){infoBox=L.control(),infoBox.onAdd=function(e){return this._div=L.DomUtil.create("div","info"),this.update(),this._div},infoBox.reupdate=function(){var e=this;this.update(this.lastprop),void 0!==this.lastprop&&currentlayer.eachLayer((function(t){e.lastprop.prov_acr?key="prov_acr":e.lastprop.reg_istat_code&&(key="reg_istat_code"),t.feature.properties[key]==e.lastprop[key]&&n(t)}))},infoBox.update=function(e){infoBox.lastprop=e,ret="<h5>"+sequence+"</h5>",e?(time_sequence[e.prov_acr]?(key=e.prov_acr,name=e.prov_name):time_sequence[e.reg_istat_code]&&(key=e.reg_istat_code,name=e.reg_name),time_sequence[key]?(current_value=time_sequence[key][current_time],end_value=time_sequence[key][time_sequence[key].length-1]):(current_value=0,end_value=0),current_date=time_ref[current_time],end_date=time_ref[time_ref.length-1],ret+="<h6>"+name+"</h6><br />",ret+=current_date+": "+current_value+"<br />",ret+=end_date+": "+end_value+"<br />"):ret+="<h6>Tocca la mappa</h6>",this._div.innerHTML=ret},infoBox.addTo(e)}(map),f(sequence)),"Lista"==page&&(table.clear(),function(e){for(key in e)index=e[key].length-1,name=namesMap[key],value=e[key][index],table.row.add([name,value]).draw()}(time_sequence)),"Grafico"==page&&(chart&&chart.destroy(),function(e){for(var t=[],r=0;r<time_ref.length;r++){var n=0;for(key in e)n+=e[key][r];t.push(n)}var a=document.getElementById("chart").getContext("2d").createLinearGradient(0,0,0,400);a.addColorStop(1,s(current_sequence.gradient[0])),a.addColorStop(0,s(current_sequence.gradient[1]));var o={labels:time_ref,datasets:[{data:t,fill:!0,backgroundColor:a}]};chart=new Chart(document.getElementById("chart"),{type:"line",data:o,options:{scales:{yAxes:[{ticks:{beginAtZero:!1}}]},legend:{display:!1},responsive:!0,maintainAspectRatio:!1}}),chart_margin=30,card_padding=$("#chartContainer").innerHeight()-$("#chartContainer").height(),$("#chartContainer").height($(window).height()-($("#navbar").outerHeight(!0)+.1*$(window).height()+card_padding+chart_margin+5)),$("#chartCard").css("margin-top",chart_margin/2),$("#chartCard").css("margin-bottom",chart_margin/2)}(time_sequence))}))}layers=void 0,sequences=void 0,time_ref=void 0,page="Mappa",sequence="Contagiati",time_sequence=void 0,animation=-1,current_time=0,map=void 0,infoBox=void 0,currentlayer=void 0,feature_persist=!1,table=void 0,chart=void 0,namesMap=void 0,$(document).ready((function(){$("#buttonCol").mousedown((function(){animation<0?(feature_persist=!1,a(),currentlayer.resetStyle(),i(layers,time_ref,map)):u()})),$("#slider").change((function(){u(),currentlayer.resetStyle(),map.removeLayer(currentlayer),current_time=Math.round($("#slider").val()/100*(time_ref.length-1)),map.addLayer(layers[current_time]),currentlayer=layers[current_time],$("#currentDate").text(time_ref[current_time]),infoBox.reupdate()})),$("#carousel").on("slide.bs.carousel",(function(e){0==e.to&&(page="Mappa"),1==e.to&&(page="Lista"),2==e.to&&(page="Grafico"),$("#pageName").text(page),_()})),$("#infoButton").mousedown((function(){$("#alert").css("display","block")})),$(".swipable").on("touchstart",(function(e){var t=e.originalEvent.touches[0].pageX;$(this).one("touchmove",(function(e){var r=e.originalEvent.touches[0].pageX;Math.floor(t-r)>5?$("#carousel").carousel("next"):Math.floor(t-r)<-5&&$("#carousel").carousel("prev")})),$(".swipable").on("touchend",(function(){$("#carousel").off("touchmove")}))})),$.getJSON("./assets/maps/names.json",(function(e){namesMap=e,table=$("#table").DataTable({order:[[1,"desc"]],scrollResize:!0,scrollCollapse:!0,paging:!1,oLanguage:{sSearch:"Cerca",sInfo:""}}),m("meta.json").then((function(e){sequences=e.sequences,function(e){for(elem in e)aElement=document.createElement("a"),$(aElement).text(elem),$(aElement).addClass("dropdown-item"),$(aElement).attr("href","#"),$(aElement).mousedown((function(e){sequence=e.target.text,_()})),$("#dropdownMenu").append(aElement)}(sequences),_()}))}))}))}]);